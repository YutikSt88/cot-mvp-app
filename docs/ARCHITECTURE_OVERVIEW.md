# COT-MVP: Architecture Overview –¥–ª—è –Ω–æ–≤–æ–≥–æ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä–∞

## üìã –©–æ –∑—Ä–æ–±–ª–µ–Ω–æ –≤ –ø—Ä–æ–µ–∫—Ç—ñ

**COT-MVP** ‚Äî —Ü–µ —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–æ–±–∫–∏ —Ç–∞ –∞–Ω–∞–ª—ñ–∑—É —Ç–∏–∂–Ω–µ–≤–∏—Ö –∑–≤—ñ—Ç—ñ–≤ Commitment of Traders (COT) –≤—ñ–¥ CFTC. –ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª—ñ–∑—É—î –ø–æ–≤–Ω–∏–π ETL pipeline –≤—ñ–¥ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–∏—Ä–∏—Ö –¥–∞–Ω–∏—Ö –¥–æ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ Streamlit dashboard.

### –û—Å–Ω–æ–≤–Ω—ñ –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è

1. **ETL Pipeline** (5 –º–æ–¥—É–ª—ñ–≤):
   - ‚úÖ INGEST: –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è ZIP-–∞—Ä—Ö—ñ–≤—ñ–≤ –∑ CFTC
   - ‚úÖ NORMALIZE: –ü–∞—Ä—Å–∏–Ω–≥ —Ç–∞ –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö –∑ QA –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞–º–∏
   - ‚úÖ COMPUTE: –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –º–µ—Ç—Ä–∏–∫ (net positioning, flips, magnitude gap, rebalance)
   - ‚úÖ ML BACKUP: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è ML-ready –¥–∞—Ç–∞—Å–µ—Ç—ñ–≤
   - ‚úÖ REGISTRY: –†–µ—î—Å—Ç—Ä –≤—Å—ñ—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ñ–≤

2. **Streamlit Dashboard**:
   - ‚úÖ Market page (landing page)
   - ‚úÖ Overview page –∑ —Ç–∞–±–∞–º–∏ (Positioning, OI, Charts)
   - ‚úÖ Week navigation (–ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –º—ñ–∂ —Ç–∏–∂–Ω—è–º–∏)
   - ‚úÖ Sidebar –∑ category/asset selection

3. **Deployment**:
   - ‚úÖ Streamlit Cloud deployment —á–µ—Ä–µ–∑ GitHub
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω—ñ —Å–∫—Ä–∏–ø—Ç–∏ –¥–ª—è build/deploy
   - ‚úÖ Smoke tests –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó deploy package

---

## üèó –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ–π

```
cot-mvp/
‚îú‚îÄ‚îÄ app.py                          # Root entrypoint –¥–ª—è Streamlit Cloud
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ ingest/                     # –ú–æ–¥—É–ª—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
‚îÇ   ‚îú‚îÄ‚îÄ normalize/                  # –ú–æ–¥—É–ª—å –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—ó
‚îÇ   ‚îú‚îÄ‚îÄ compute/                    # –ú–æ–¥—É–ª—å –æ–±—á–∏—Å–ª–µ–Ω—å –º–µ—Ç—Ä–∏–∫
‚îÇ   ‚îú‚îÄ‚îÄ registry/                   # –ú–æ–¥—É–ª—å —Ä–µ—î—Å—Ç—Ä—É –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ñ–≤
‚îÇ   ‚îú‚îÄ‚îÄ app/                        # Streamlit dashboard
‚îÇ   ‚îî‚îÄ‚îÄ common/                     # –°–ø—ñ–ª—å–Ω—ñ —É—Ç–∏–ª—ñ—Ç–∏
‚îú‚îÄ‚îÄ configs/                        # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–∏–Ω–∫—ñ–≤
‚îú‚îÄ‚îÄ data/                           # –î–∞–Ω—ñ (raw, canonical, compute, ml, registry)
‚îú‚îÄ‚îÄ scripts/                        # –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è (build, deploy, backup)
‚îú‚îÄ‚îÄ deploy/                         # Deploy package (—Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ)
‚îú‚îÄ‚îÄ deploy_repo/                    # –õ–æ–∫–∞–ª—å–Ω–∏–π –∫–ª–æ–Ω GitHub repo –¥–ª—è deploy
‚îî‚îÄ‚îÄ docs/                           # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
```

### ETL Pipeline Flow

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   INGEST    ‚îÇ --> ‚îÇ  NORMALIZE   ‚îÇ --> ‚îÇ   COMPUTE    ‚îÇ
‚îÇ             ‚îÇ     ‚îÇ              ‚îÇ     ‚îÇ              ‚îÇ
‚îÇ ZIP –∑ CFTC  ‚îÇ     ‚îÇ Canonical    ‚îÇ     ‚îÇ Metrics      ‚îÇ
‚îÇ + Manifest  ‚îÇ     ‚îÇ + QA         ‚îÇ     ‚îÇ (144 cols)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚îÇ                     ‚îÇ
      ‚îÇ                     ‚ñº
      ‚îÇ              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ              ‚îÇ  ML BACKUP   ‚îÇ
      ‚îÇ              ‚îÇ              ‚îÇ
      ‚îÇ              ‚îÇ ML –¥–∞—Ç–∞—Å–µ—Ç   ‚îÇ
      ‚îÇ              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚îÇ
      ‚îî------------------> ‚îÇ
                           ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   REGISTRY   ‚îÇ
                    ‚îÇ              ‚îÇ
                    ‚îÇ –†–µ—î—Å—Ç—Ä       ‚îÇ
                    ‚îÇ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ñ–≤   ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìÅ –î–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å —Ñ–∞–π–ª—ñ–≤

### Root Level

#### `app.py` ‚≠ê **–ö–†–ò–¢–ò–ß–ù–ò–ô**
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** Root entrypoint –¥–ª—è Streamlit Cloud deployment  
**–©–æ —Ä–æ–±–∏—Ç—å:**
- –î–æ–¥–∞—î repo root –¥–æ `sys.path` (–¥–ª—è —ñ–º–ø–æ—Ä—Ç—ñ–≤ `from src...`)
- –ó–∞–ø—É—Å–∫–∞—î `src/app/app.py` —á–µ—Ä–µ–∑ `runpy.run_path()`
- **–ß–æ–º—É –ø–æ—Ç—Ä—ñ–±–µ–Ω:** Streamlit Cloud –∑–∞–ø—É—Å–∫–∞—î —Ñ–∞–π–ª –∑ root, –∞–ª–µ —ñ–º–ø–æ—Ä—Ç–∏ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å `src/` –≤ PYTHONPATH

**–ü—Ä–æ–±–ª–µ–º–∏:**
- ‚ùå –ó–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ `runpy` (–º–æ–∂–µ –±—É—Ç–∏ –ø—Ä–æ–±–ª–µ–º–∏ –Ω–∞ –¥–µ—è–∫–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö)
- ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ: –¥–æ–¥–∞–Ω–æ `sys.path.insert(0, REPO_ROOT)`

---

### `src/ingest/` ‚Äî –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö

#### `run_ingest.py` ‚≠ê **–ö–†–ò–¢–ò–ß–ù–ò–ô**
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ì–æ–ª–æ–≤–Ω–∏–π runner –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è ZIP-–∞—Ä—Ö—ñ–≤—ñ–≤ –∑ CFTC  
**–©–æ —Ä–æ–±–∏—Ç—å:**
- –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î ZIP-–∞—Ä—Ö—ñ–≤–∏ –∑–∞ —Ä–æ–∫–∞–º–∏ –∑ CFTC
- –û–Ω–æ–≤–ª—é—î `data/raw/manifest.csv` (–≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å)
- –ü—ñ–¥—Ç—Ä–∏–º—É—î refresh window (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ/–º–∏–Ω—É–ª–æ–≥–æ —Ä–æ–∫—É)

**–í—Ö—ñ–¥:** URL template –∑ `configs/markets.yaml`  
**–í–∏—Ö—ñ–¥:** `data/raw/legacy_futures_only/{year}/deacot{year}.zip` + `manifest.csv`

**–ü—Ä–æ–±–ª–µ–º–∏:**
- ‚úÖ –ü—Ä–∞—Ü—é—î —Å—Ç–∞–±—ñ–ª—å–Ω–æ
- ‚ö†Ô∏è –ó–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ CFTC —Å–µ—Ä–≤–µ—Ä—ñ–≤

#### `cftc_downloader.py`
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** HTTP –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ retry –ª–æ–≥—ñ–∫–æ—é  
**–©–æ —Ä–æ–±–∏—Ç—å:**
- –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î —Ñ–∞–π–ª–∏ –∑ retry (tenacity)
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î SHA256 checksums
- –û–±—Ä–æ–±–ª—è—î –ø–æ–º–∏–ª–∫–∏ –º–µ—Ä–µ–∂—ñ

#### `manifest.py`
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –†–æ–±–æ—Ç–∞ –∑ manifest (—Ä–µ—î—Å—Ç—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å)  
**–©–æ —Ä–æ–±–∏—Ç—å:**
- –ß–∏—Ç–∞—î/–∑–∞–ø–∏—Å—É—î `manifest.csv`
- –í—ñ–¥—Å—Ç–µ–∂—É—î —Å—Ç–∞—Ç—É—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å (OK, ERROR, UNCHANGED)
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î checksums

---

### `src/normalize/` ‚Äî –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö

#### `run_normalize.py` ‚≠ê **–ö–†–ò–¢–ò–ß–ù–ò–ô**
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ì–æ–ª–æ–≤–Ω–∏–π runner –¥–ª—è –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—ó —Å–∏—Ä–∏—Ö –¥–∞–Ω–∏—Ö  
**–©–æ —Ä–æ–±–∏—Ç—å:**
1. –ß–∏—Ç–∞—î manifest (—Ç—ñ–ª—å–∫–∏ —Å—Ç–∞—Ç—É—Å OK)
2. –ü–∞—Ä—Å–∏—Ç—å `annual.txt` –∑ ZIP-–∞—Ä—Ö—ñ–≤—ñ–≤
3. –§—ñ–ª—å—Ç—Ä—É—î –ø–æ contract codes –∑ whitelist (`configs/markets.yaml`)
4. –°—Ç–≤–æ—Ä—é—î canonical datasets:
   - `cot_weekly_canonical.parquet` (legacy, NC-only)
   - `cot_weekly_canonical_full.parquet` (COMM/NONCOMM/NONREPT)
5. –í–∏–∫–æ–Ω—É—î QA –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ (blocking)

**–í—Ö—ñ–¥:** ZIP-–∞—Ä—Ö—ñ–≤–∏ –∑ `data/raw/` + `configs/markets.yaml`  
**–í–∏—Ö—ñ–¥:** `data/canonical/cot_weekly_canonical_full.parquet` + `qa_report.txt`

**–ü—Ä–æ–±–ª–µ–º–∏:**
- ‚úÖ –ü—Ä–∞—Ü—é—î —Å—Ç–∞–±—ñ–ª—å–Ω–æ
- ‚ö†Ô∏è QA blocking –º–æ–∂–µ –∑—É–ø–∏–Ω–∏—Ç–∏ pipeline –ø—Ä–∏ –ø–æ–º–∏–ª–∫–∞—Ö

#### `run_ml_backup.py`
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –°—Ç–≤–æ—Ä–µ–Ω–Ω—è ML-ready –¥–∞—Ç–∞—Å–µ—Ç—ñ–≤  
**–©–æ —Ä–æ–±–∏—Ç—å:**
- –°—Ç–≤–æ—Ä—é—î –æ—á–∏—â–µ–Ω–∏–π –¥–∞—Ç–∞—Å–µ—Ç –∑ canonical (–≤–∏–∫–ª—é—á–∞—î —Ç–µ—Ö–Ω—ñ—á–Ω—ñ –∫–æ–ª–æ–Ω–∫–∏)
- –†–µ–∂–∏–º `--all-assets`: –ø–æ–≤–Ω–∏–π –¥–∞—Ç–∞—Å–µ—Ç –≤—Å—ñ—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ñ–≤ –∑ raw snapshots

**–í–∏—Ö—ñ–¥:** `data/ml/cot_weekly_ml.parquet`

---

### `src/compute/` ‚Äî –û–±—á–∏—Å–ª–µ–Ω–Ω—è –º–µ—Ç—Ä–∏–∫

#### `run_compute.py` ‚≠ê **–ö–†–ò–¢–ò–ß–ù–ò–ô**
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ì–æ–ª–æ–≤–Ω–∏–π runner –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –º–µ—Ç—Ä–∏–∫  
**–©–æ —Ä–æ–±–∏—Ç—å:**
- –ß–∏—Ç–∞—î canonical dataset
- –í–∏–∫–ª–∏–∫–∞—î `build_metrics()` –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –≤—Å—ñ—Ö –º–µ—Ç—Ä–∏–∫
- –í–∏–∫–æ–Ω—É—î validations
- –ó–∞–ø–∏—Å—É—î `metrics_weekly.parquet`

**–í—Ö—ñ–¥:** `data/canonical/cot_weekly_canonical_full.parquet`  
**–í–∏—Ö—ñ–¥:** `data/compute/metrics_weekly.parquet` (144 –∫–æ–ª–æ–Ω–∫–∏)

#### `build_metrics.py` ‚≠ê **–ö–†–ò–¢–ò–ß–ù–ò–ô**
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤—Å—ñ—Ö –º–µ—Ç—Ä–∏–∫  
**–©–æ —Ä–æ–±–∏—Ç—å:**
- Net positioning metrics (nc_net, comm_net, spec_vs_hedge_net)
- Weekly change metrics (*_chg_1w)
- Flip detection flags (*_flip_1w)
- Net side & alignment tracking
- Magnitude gap –∑ 5Y normalization
- Rebalance decomposition
- Positioning metrics (ALL Time + 5Y rolling)
- OI metrics (open_interest, open_interest_chg_1w, open_interest_chg_1w_pct)
- OI v1 metrics (participation, flows, trend)

**–ü—Ä–æ–±–ª–µ–º–∏:**
- ‚ö†Ô∏è –í–µ–ª–∏–∫–∏–π —Ñ–∞–π–ª (~2000 —Ä—è–¥–∫—ñ–≤) ‚Äî –ø–æ—Ç—Ä–µ–±—É—î —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É
- ‚ö†Ô∏è –î–µ—è–∫—ñ –º–µ—Ç—Ä–∏–∫–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏–º–∏
- ‚úÖ –î–µ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω—ñ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∏ (–±–µ–∑ look-ahead)

#### `validations.py`
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –í–∞–ª—ñ–¥–∞—Ü—ñ—è –º–µ—Ç—Ä–∏–∫  
**–©–æ —Ä–æ–±–∏—Ç—å:**
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î required columns
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î –¥—ñ–∞–ø–∞–∑–æ–Ω–∏ –∑–Ω–∞—á–µ–Ω—å
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î NaN/inf
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î first-row NaN allowance

---

### `src/registry/` ‚Äî –†–µ—î—Å—Ç—Ä –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ñ–≤

#### `run_registry.py`
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ì–æ–ª–æ–≤–Ω–∏–π runner –¥–ª—è –ø–æ–±—É–¥–æ–≤–∏ —Ä–µ—î—Å—Ç—Ä—É  
**–©–æ —Ä–æ–±–∏—Ç—å:**
- –ß–∏—Ç–∞—î raw snapshots
- –ê–≥—Ä–µ–≥—É—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∏ (first_seen, last_seen, names)
- –°—Ç–≤–æ—Ä—é—î `contracts_registry.parquet`

**–í–∏—Ö—ñ–¥:** `data/registry/contracts_registry.parquet`

---

### `src/app/` ‚Äî Streamlit Dashboard

#### `app.py` ‚≠ê **–ö–†–ò–¢–ò–ß–ù–ò–ô**
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** Main entry point –¥–ª—è Streamlit app  
**–©–æ —Ä–æ–±–∏—Ç—å:**
- –ù–∞–ª–∞—à—Ç–æ–≤—É—î page config
- –†–µ–Ω–¥–µ—Ä–∏—Ç—å sidebar
- –ü–æ–∫–∞–∑—É—î Market page content (landing page)

**–ü—Ä–æ–±–ª–µ–º–∏:**
- ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ: –ø—Ä–∏–±—Ä–∞–Ω–æ `st.switch_page()` (–≤–∏–∫–ª–∏–∫–∞–≤ –ø–æ–º–∏–ª–∫–∏)

#### `pages/market.py`
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** Market page (placeholder)  
**–©–æ —Ä–æ–±–∏—Ç—å:**
- –ü–æ–∫–∞–∑—É—î placeholder –¥–ª—è –º–∞–π–±—É—Ç–Ω—å–æ–≥–æ Market Scanner
- –†–µ–Ω–¥–µ—Ä–∏—Ç—å sidebar –∑ "Go to Overview" button

#### `pages/overview.py` ‚≠ê **–ö–†–ò–¢–ò–ß–ù–ò–ô**
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** Overview page –∑ –ø–æ–≤–Ω–∏–º –∑–≤—ñ—Ç–æ–º –ø—Ä–æ –∞–∫—Ç–∏–≤–∏  
**–©–æ —Ä–æ–±–∏—Ç—å:**
- –ü–æ–∫–∞–∑—É—î —Ç–∞–±–∏: Positioning, OI, Charts
- Positioning tab: –ø–æ–≤–Ω–∏–π –∑–≤—ñ—Ç (Asset State, Weekly Change, Positioning Summary, Magnitude Gap, Flow Quality, —Ç–∞–±–ª–∏—Ü—è)
- OI tab: OI metrics (level, change, participation, flows, trend)
- Charts tab: placeholder
- Week navigation (–ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –º—ñ–∂ —Ç–∏–∂–Ω—è–º–∏)

**–ü—Ä–æ–±–ª–µ–º–∏:**
- ‚ö†Ô∏è –í–µ–ª–∏–∫–∏–π —Ñ–∞–π–ª (~1600 —Ä—è–¥–∫—ñ–≤) ‚Äî –ø–æ—Ç—Ä–µ–±—É—î —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É
- ‚ö†Ô∏è –î–µ—è–∫—ñ –±–ª–æ–∫–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏–º–∏

#### `ui_state.py` ‚≠ê **–ö–†–ò–¢–ò–ß–ù–ò–ô**
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** UI state management (sidebar, selections)  
**–©–æ —Ä–æ–±–∏—Ç—å:**
- –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î `configs/markets.yaml`
- –ö–µ—Ä—É—î session state (selected_category, selected_asset)
- –†–µ–Ω–¥–µ—Ä–∏—Ç—å sidebar –∑ category/asset selectors
- –ù–∞–≤—ñ–≥–∞—Ü—ñ—è –º—ñ–∂ —Å—Ç–æ—Ä—ñ–Ω–∫–∞–º–∏

**–ü—Ä–æ–±–ª–µ–º–∏:**
- ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ: –¥–æ–¥–∞–Ω–æ –æ–±—Ä–æ–±–∫—É –ø–æ–º–∏–ª–æ–∫ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è config
- ‚ö†Ô∏è –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î HTML link –¥–ª—è –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó (–∑–∞–º—ñ—Å—Ç—å `st.switch_page()`)

#### `components/heatline.py`
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** Heatline –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó –ø–æ–∑–∏—Ü—ñ–π  
**–©–æ —Ä–æ–±–∏—Ç—å:**
- –†–µ–Ω–¥–µ—Ä–∏—Ç—å heatline bar (min/max/current)
- –ü—ñ–¥—Ç—Ä–∏–º—É—î tooltip –∑ –¥–µ—Ç–∞–ª—è–º–∏

#### `components/state_header.py`
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** Header –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å—Ç–∞–Ω—É –∞–∫—Ç–∏–≤—É  
**–©–æ —Ä–æ–±–∏—Ç—å:**
- –ü–æ–∫–∞–∑—É—î market_key, category
- –ü–æ–∫–∞–∑—É—î week navigation (‚óÄ ‚ñ∂)

---

### `src/common/` ‚Äî –°–ø—ñ–ª—å–Ω—ñ —É—Ç–∏–ª—ñ—Ç–∏

#### `paths.py`
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** ProjectPaths dataclass  
**–©–æ —Ä–æ–±–∏—Ç—å:**
- –í–∏–∑–Ω–∞—á–∞—î —Å—Ç—Ä—É–∫—Ç—É—Ä—É —à–ª—è—Ö—ñ–≤ –ø—Ä–æ–µ–∫—Ç—É (configs, data, raw, canonical, etc.)

#### `dates.py`
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –¥–∞—Ç–∞–º–∏  
**–©–æ —Ä–æ–±–∏—Ç—å:**
- –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç –∑ COT —Ñ–æ—Ä–º–∞—Ç—ñ–≤
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –º—ñ–∂ —Ñ–æ—Ä–º–∞—Ç–∞–º–∏

#### `logging.py`
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ª–æ–≥—É–≤–∞–Ω–Ω—è  
**–©–æ —Ä–æ–±–∏—Ç—å:**
- –ö–æ–Ω—Ñ—ñ–≥—É—Ä—É—î logging –¥–ª—è –≤—Å—ñ—Ö –º–æ–¥—É–ª—ñ–≤

#### `contract_codes.py`
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –£—Ç–∏–ª—ñ—Ç–∏ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ contract codes  
**–©–æ —Ä–æ–±–∏—Ç—å:**
- –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è contract codes
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è —Ñ–æ—Ä–º–∞—Ç—ñ–≤

---

### `configs/` ‚Äî –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

#### `markets.yaml` ‚≠ê **–ö–†–ò–¢–ò–ß–ù–ò–ô**
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–∏–Ω–∫—ñ–≤ —Ç–∞ –¥–∂–µ—Ä–µ–ª–∞ –¥–∞–Ω–∏—Ö  
**–©–æ —Ä–æ–±–∏—Ç—å:**
- –í–∏–∑–Ω–∞—á–∞—î —Å–ø–∏—Å–æ–∫ —Ä–∏–Ω–∫—ñ–≤ (market_key, contract_code, category)
- –í–∏–∑–Ω–∞—á–∞—î URL template –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```yaml
source:
  dataset: "legacy_futures_only"
  cftc_historical_zip_url_template: "https://www.cftc.gov/files/dea/history/deacot{year}.zip"

markets:
  - market_key: "EUR"
    contract_code: "099741"
    category: "FX"
```

#### `contracts_meta.yaml`
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ú–µ—Ç–∞–¥–∞–Ω—ñ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ñ–≤ (enabled/disabled)  
**–©–æ —Ä–æ–±–∏—Ç—å:**
- –í–∏–∑–Ω–∞—á–∞—î —è–∫—ñ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∏ –∞–∫—Ç–∏–≤–Ω—ñ
- –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î—Ç—å—Å—è –∑ `markets.yaml` —á–µ—Ä–µ–∑ `scripts/sync_markets_from_meta.py`

---

### `scripts/` ‚Äî –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è

#### `build_deploy_package.py` ‚≠ê **–ö–†–ò–¢–ò–ß–ù–ò–ô**
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –°—Ç–≤–æ—Ä–µ–Ω–Ω—è deploy package –¥–ª—è Streamlit Cloud  
**–©–æ —Ä–æ–±–∏—Ç—å:**
- –ö–æ–ø—ñ—é—î `src/`, `configs/`, `data/compute/metrics_weekly.parquet`
- –ö–æ–ø—ñ—é—î `app.py`, `src/__init__.py`, `.streamlit/`, `requirements.txt`
- –°—Ç–≤–æ—Ä—é—î `deploy/streamlit_app/`

**–í–∏—Ö—ñ–¥:** `deploy/streamlit_app/` (–≥–æ—Ç–æ–≤–∏–π –¥–æ deploy)

#### `deploy_to_github.ps1` ‚≠ê **–ö–†–ò–¢–ò–ß–ù–ò–ô**
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π deploy –¥–æ GitHub  
**–©–æ —Ä–æ–±–∏—Ç—å:**
1. –í–∏–∫–ª–∏–∫–∞—î `build_deploy_package.py`
2. –í–∏–∫–ª–∏–∫–∞—î `smoke_test_deploy.py`
3. Hard-sync –¥–æ `deploy_repo/`
4. Git commit + push –¥–æ `YutikSt88/cot-mvp-app`

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:**
```powershell
powershell -ExecutionPolicy Bypass -File scripts/deploy_to_github.ps1
```

#### `smoke_test_deploy.py`
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –í–∞–ª—ñ–¥–∞—Ü—ñ—è deploy package  
**–©–æ —Ä–æ–±–∏—Ç—å:**
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î –Ω–∞—è–≤–Ω—ñ—Å—Ç—å `app.py`, `src/__init__.py`
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î `metrics_weekly.parquet` (–∫–æ–ª–æ–Ω–∫–∏, —Ä—è–¥–∫–∏, –¥–∞—Ç–∏)
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î import paths

#### `run_weekly.ps1`
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –¢–∏–∂–Ω–µ–≤–∏–π pipeline (ingest ‚Üí normalize ‚Üí compute)  
**–©–æ —Ä–æ–±–∏—Ç—å:**
- –ó–∞–ø—É—Å–∫–∞—î –≤—Å—ñ –µ—Ç–∞–ø–∏ pipeline –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ
- –û–Ω–æ–≤–ª—é—î –¥–∞–Ω—ñ –¥–ª—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ —Ç–∏–∂–Ω—è

#### `backup_release.py`
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –°—Ç–≤–æ—Ä–µ–Ω–Ω—è backup –∞—Ä—Ö—ñ–≤—ñ–≤  
**–©–æ —Ä–æ–±–∏—Ç—å:**
- –°—Ç–≤–æ—Ä—é—î zip –∞—Ä—Ö—ñ–≤ –∫–æ–¥—É (–±–µ–∑ .venv, data)
- –ó–±–µ—Ä—ñ–≥–∞—î –≤ `backups/`

#### `sync_markets_from_meta.py`
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è `markets.yaml` –∑ `contracts_meta.yaml`  
**–©–æ —Ä–æ–±–∏—Ç—å:**
- –ß–∏—Ç–∞—î enabled contracts –∑ `contracts_meta.yaml`
- –û–Ω–æ–≤–ª—é—î `markets.yaml`

---

### `docs/` ‚Äî –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

#### `DEPLOY_STREAMLIT.md` ‚≠ê **–ö–†–ò–¢–ò–ß–ù–ò–ô**
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –∑ –¥–µ–ø–ª–æ—é –Ω–∞ Streamlit Cloud  
**–©–æ –º—ñ—Å—Ç–∏—Ç—å:**
- Prerequisites
- First deploy (bootstrap)
- Weekly update flow
- Troubleshooting

#### `BACKUP.md`
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –∑ backup —Ç–∞ rollback  
**–©–æ –º—ñ—Å—Ç–∏—Ç—å:**
- –ö–æ–º–∞–Ω–¥–∏ –¥–ª—è backup
- Git tagging
- Rollback procedures

---

## üöÄ –Ø–∫ –∑–∞–¥–µ–ø–ª–æ—î–Ω–æ

### Deployment Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  cot-mvp (dev)  ‚îÇ --> ‚îÇ deploy/streamlit ‚îÇ --> ‚îÇ  cot-mvp-app    ‚îÇ
‚îÇ                 ‚îÇ     ‚îÇ      _app/       ‚îÇ     ‚îÇ   (GitHub)      ‚îÇ
‚îÇ Main repo       ‚îÇ     ‚îÇ Deploy package   ‚îÇ     ‚îÇ Deploy repo     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                          ‚îÇ
                                                          ‚ñº
                                                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                                  ‚îÇ Streamlit Cloud ‚îÇ
                                                  ‚îÇ                 ‚îÇ
                                                  ‚îÇ Auto-redeploy   ‚îÇ
                                                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Deployment Process

1. **Build Deploy Package:**
   ```bash
   python scripts/build_deploy_package.py
   ```
   - –°—Ç–≤–æ—Ä—é—î `deploy/streamlit_app/` –∑ —É—Å—ñ–º–∞ –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏
   - –ö–æ–ø—ñ—é—î `src/`, `configs/`, `data/compute/metrics_weekly.parquet`
   - –ö–æ–ø—ñ—é—î `app.py` (root entrypoint), `src/__init__.py`

2. **Smoke Test:**
   ```bash
   python scripts/smoke_test_deploy.py
   ```
   - –ü–µ—Ä–µ–≤—ñ—Ä—è—î –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –≤—Å—ñ—Ö —Ñ–∞–π–ª—ñ–≤
   - –í–∞–ª—ñ–¥—É—î `metrics_weekly.parquet`

3. **Deploy to GitHub:**
   ```powershell
   powershell -ExecutionPolicy Bypass -File scripts/deploy_to_github.ps1
   ```
   - Hard-sync –¥–æ `deploy_repo/`
   - Git commit + push –¥–æ `YutikSt88/cot-mvp-app`

4. **Streamlit Cloud:**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—î app –ø—ñ—Å–ª—è push
   - Main file: `app.py`
   - Branch: `main`

### Streamlit Cloud Settings

- **Repository:** `YutikSt88/cot-mvp-app`
- **Branch:** `main`
- **Main file:** `app.py` (root entrypoint)
- **App URL:** `cot-app.streamlit.app`

---

## üêõ –ü—Ä–æ–±–ª–µ–º–∏ —Ç–∞ —è–∫ –∑ –Ω–∏–º–∏ —Å–ø—Ä–∞–≤–ª—è—î–º–æ—Å—å

### –í–∏—Ä—ñ—à–µ–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏

#### 1. **ModuleNotFoundError: No module named 'src'**
**–ü—Ä–æ–±–ª–µ–º–∞:** Streamlit Cloud –Ω–µ –º—ñ–≥ —ñ–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ `from src...`  
**–†—ñ—à–µ–Ω–Ω—è:**
- –°—Ç–≤–æ—Ä–µ–Ω–æ `app.py` (root entrypoint) —è–∫–∏–π –¥–æ–¥–∞—î repo root –¥–æ `sys.path`
- –î–æ–¥–∞–Ω–æ `src/__init__.py` (package marker)

**–§–∞–π–ª–∏:**
- `app.py` ‚Äî root entrypoint
- `src/__init__.py` ‚Äî package marker

#### 2. **StreamlitAPIException: st.switch_page() –Ω–∞ –≤–µ—Ä—Ö–Ω—å–æ–º—É —Ä—ñ–≤–Ω—ñ**
**–ü—Ä–æ–±–ª–µ–º–∞:** `st.switch_page()` –≤–∏–∫–ª–∏–∫–∞–≤—Å—è –Ω–∞ –≤–µ—Ä—Ö–Ω—å–æ–º—É —Ä—ñ–≤–Ω—ñ –º–æ–¥—É–ª—è  
**–†—ñ—à–µ–Ω–Ω—è:**
- –ü—Ä–∏–±—Ä–∞–Ω–æ `st.switch_page()` –∑ `src/app/app.py`
- –ó–∞–º—ñ–Ω–µ–Ω–æ –Ω–∞ –ø—Ä—è–º–∏–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–æ–Ω—Ç–µ–Ω—Ç—É
- –í `ui_state.py` –∑–∞–º—ñ–Ω–µ–Ω–æ –Ω–∞ HTML link –¥–ª—è –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó

**–§–∞–π–ª–∏:**
- `src/app/app.py` ‚Äî –ø—Ä–∏–±—Ä–∞–Ω–æ redirect
- `src/app/ui_state.py` ‚Äî HTML link –∑–∞–º—ñ—Å—Ç—å `st.switch_page()`

#### 3. **App –∑–∞–≤–∏—Å–∞—î –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ**
**–ü—Ä–æ–±–ª–µ–º–∞:** App –∑–∞–≤–∏—Å–∞–≤ —á–µ—Ä–µ–∑ –ø–æ–º–∏–ª–∫–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó  
**–†—ñ—à–µ–Ω–Ω—è:**
- –î–æ–¥–∞–Ω–æ –æ–±—Ä–æ–±–∫—É –ø–æ–º–∏–ª–æ–∫ —É `load_markets_config()`
- –î–æ–¥–∞–Ω–æ `@st.cache_data` –¥–ª—è `get_project_paths()`
- –î–æ–¥–∞–Ω–æ warning/error –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

**–§–∞–π–ª–∏:**
- `src/app/ui_state.py` ‚Äî –¥–æ–¥–∞–Ω–æ try/except + st.warning/error

#### 4. **Git "unknown switch 'E'" –ø–æ–º–∏–ª–∫–∞**
**–ü—Ä–æ–±–ª–µ–º–∞:** PowerShell —Å–∫—Ä–∏–ø—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∏ –Ω–µ–±–µ–∑–ø–µ—á–Ω—ñ git –∫–æ–º–∞–Ω–¥–∏  
**–†—ñ—à–µ–Ω–Ω—è:**
- –ü—Ä–∏–±—Ä–∞–Ω–æ `git remote get-url --push`
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ `git remote -v` –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏

**–§–∞–π–ª–∏:**
- `scripts/deploy_to_github.ps1` ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –±–µ–∑–ø–µ—á–Ω—ñ git –∫–æ–º–∞–Ω–¥–∏

---

### –ù–µ–≤—ñ—Ä—ñ—à–µ–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏

#### 1. **–í–µ–ª–∏–∫—ñ —Ñ–∞–π–ª–∏ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É**
**–ü—Ä–æ–±–ª–µ–º–∞:**
- `src/compute/build_metrics.py` (~2000 —Ä—è–¥–∫—ñ–≤)
- `src/app/pages/overview.py` (~1600 —Ä—è–¥–∫—ñ–≤)

**–í–ø–ª–∏–≤:**
- –í–∞–∂–∫–æ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏
- –í–∞–∂–∫–æ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏
- –ú–æ–∂–ª–∏–≤—ñ –¥—É–±–ª—ñ–∫–∞—Ç–∏ –∫–æ–¥—É

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:**
- –†–æ–∑–±–∏—Ç–∏ `build_metrics.py` –Ω–∞ –º–æ–¥—É–ª—ñ (net_metrics, flip_metrics, magnitude_metrics, etc.)
- –†–æ–∑–±–∏—Ç–∏ `overview.py` –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ (positioning_tab, oi_tab, charts_tab)

#### 2. **–ó–∞—Å—Ç–∞—Ä—ñ–ª—ñ/–µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ñ –º–µ—Ç—Ä–∏–∫–∏**
**–ü—Ä–æ–±–ª–µ–º–∞:**
- –î–µ—è–∫—ñ –º–µ—Ç—Ä–∏–∫–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏–º–∏
- Flow Quality / Rebalance metrics –ø–æ–∑–Ω–∞—á–µ–Ω—ñ —è–∫ experimental

**–í–ø–ª–∏–≤:**
- –ù–µ—è—Å–Ω–æ —è–∫—ñ –º–µ—Ç—Ä–∏–∫–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏
- –ú–æ–∂–ª–∏–≤—ñ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∏ –º—ñ–∂ –º–µ—Ç—Ä–∏–∫–∞–º–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:**
- –ê—É–¥–∏—Ç –º–µ—Ç—Ä–∏–∫ (–≤–∏–∑–Ω–∞—á–∏—Ç–∏ —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è, —è–∫—ñ –∑–∞—Å—Ç–∞—Ä—ñ–ª—ñ)
- –î–æ–∫—É–º–µ–Ω—Ç—É–≤–∞—Ç–∏ —è–∫—ñ –º–µ—Ç—Ä–∏–∫–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ñ

#### 3. **–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å —Ç–µ—Å—Ç—ñ–≤**
**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ–º–∞—î unit tests
- –ù–µ–º–∞—î integration tests
- –¢—ñ–ª—å–∫–∏ smoke tests –¥–ª—è deploy

**–í–ø–ª–∏–≤:**
- –í–∞–∂–∫–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ—Å—Ç—å —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤
- –†–∏–∑–∏–∫ —Ä–µ–≥—Ä–µ—Å—ñ–π –ø—Ä–∏ –∑–º—ñ–Ω–∞—Ö

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:**
- –î–æ–¥–∞—Ç–∏ unit tests –¥–ª—è `build_metrics.py`
- –î–æ–¥–∞—Ç–∏ integration tests –¥–ª—è pipeline
- –î–æ–¥–∞—Ç–∏ snapshot tests –¥–ª—è UI

#### 4. **–î—É–±–ª—é–≤–∞–Ω–Ω—è –∫–æ–¥—É**
**–ü—Ä–æ–±–ª–µ–º–∞:**
- `get_project_paths()` –¥—É–±–ª—é—î—Ç—å—Å—è –≤ `src/app/ui_state.py` —Ç–∞ `src/app/pages/overview.py`
- –î–µ—è–∫—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –º–æ–∂—É—Ç—å –±—É—Ç–∏ –¥—É–±–ª—å–æ–≤–∞–Ω—ñ

**–í–ø–ª–∏–≤:**
- –í–∞–∂–∫–æ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏
- –ú–æ–∂–ª–∏–≤—ñ –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:**
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `src/common/paths.py` –¥–ª—è –≤—Å—ñ—Ö —à–ª—è—Ö—ñ–≤
- –°—Ç–≤–æ—Ä–∏—Ç–∏ —Å–ø—ñ–ª—å–Ω—ñ —É—Ç–∏–ª—ñ—Ç–∏ –¥–ª—è UI

#### 5. **–ó–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –≤—ñ–¥ Streamlit Cloud**
**–ü—Ä–æ–±–ª–µ–º–∞:**
- Deployment –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ Streamlit Cloud
- –ù–µ–º–∞—î –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏—Ö —Å–ø–æ—Å–æ–±—ñ–≤ deploy

**–í–ø–ª–∏–≤:**
- Vendor lock-in
- –û–±–º–µ–∂–µ–Ω–Ω—è Streamlit Cloud

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:**
- –†–æ–∑–≥–ª—è–Ω—É—Ç–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏ (Docker, self-hosted)
- –ê–±—Å—Ç—Ä–∞–≥—É–≤–∞—Ç–∏ deployment logic

---

## üóë –©–æ –∑–∞—Å—Ç–∞—Ä—ñ–ª–µ/–ª–∏—à–Ω—î

### –ó–∞—Å—Ç–∞—Ä—ñ–ª—ñ —Ñ–∞–π–ª–∏

#### 1. **`src/normalize/canonical_schema.py`**
**–ü—Ä–æ–±–ª–µ–º–∞:** Legacy schema (NC-only), –∑–∞–º—ñ–Ω–µ–Ω–æ –Ω–∞ `canonical_full_schema.py`  
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:** –í–∏–¥–∞–ª–∏—Ç–∏ –∞–±–æ –ø–µ—Ä–µ–º—ñ—Å—Ç–∏—Ç–∏ –≤ `docs/legacy/`

#### 2. **`backups/` –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–∞–≥–∞—Ç–æ —Å—Ç–∞—Ä–∏—Ö backup –∞—Ä—Ö—ñ–≤—ñ–≤  
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:** –û—á–∏—Å—Ç–∏—Ç–∏ —Å—Ç–∞—Ä—ñ backups (–∑–∞–ª–∏—à–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ –æ—Å—Ç–∞–Ω–Ω—ñ 3-5)

#### 3. **`deploy_repo/` –≤ .gitignore**
**–ü—Ä–æ–±–ª–µ–º–∞:** –õ–æ–∫–∞–ª—å–Ω–∏–π –∫–ª–æ–Ω GitHub repo, –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É —Ä–µ–ø–æ  
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:** –í–∂–µ –≤ .gitignore, –∞–ª–µ –º–æ–∂–Ω–∞ –≤–∏–¥–∞–ª–∏—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–æ —è–∫—â–æ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è

### –£—Å–∫–ª–∞–¥–Ω—é—é—Ç—å —Ä–æ–±–æ—Ç—É

#### 1. **–î–≤–∞ entry points (`app.py` —Ç–∞ `src/app/app.py`)**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–ª—É—Ç–∞–Ω–∏–Ω–∞ –º—ñ–∂ root entrypoint —Ç–∞ actual app  
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:** –î–æ–∫—É–º–µ–Ω—Ç—É–≤–∞—Ç–∏ —á—ñ—Ç–∫–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∫–æ–∂–Ω–æ–≥–æ

#### 2. **–î–≤–∞ deploy —Å–∫—Ä–∏–ø—Ç–∏ (`deploy_to_github.ps1` —Ç–∞ `push_deploy_repo.ps1`)**
**–ü—Ä–æ–±–ª–µ–º–∞:** –î—É–±–ª—é–≤–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ  
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ `deploy_to_github.ps1`, –≤–∏–¥–∞–ª–∏—Ç–∏ `push_deploy_repo.ps1`

#### 3. **–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å —á—ñ—Ç–∫–æ—ó —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —Ä–æ–∑–∫–∏–¥–∞–Ω—ñ –ø–æ —Ä—ñ–∑–Ω–∏—Ö —Ñ–∞–π–ª–∞—Ö  
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:** –°—Ç–≤–æ—Ä–∏—Ç–∏ —á—ñ—Ç–∫—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É `src/app/components/` –∑ –ø—ñ–¥–∫–∞—Ç–∞–ª–æ–≥–∞–º–∏

#### 4. **–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å type hints –≤ –¥–µ—è–∫–∏—Ö –º—ñ—Å—Ü—è—Ö**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ –≤—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –º–∞—é—Ç—å type hints  
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:** –î–æ–¥–∞—Ç–∏ type hints –¥–ª—è –≤—Å—ñ—Ö –ø—É–±–ª—ñ—á–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç—É

### –†–æ–∑–º—ñ—Ä–∏ —Ñ–∞–π–ª—ñ–≤
- `src/compute/build_metrics.py`: ~2000 —Ä—è–¥–∫—ñ–≤
- `src/app/pages/overview.py`: ~1600 —Ä—è–¥–∫—ñ–≤
- `src/normalize/run_normalize.py`: ~500 —Ä—è–¥–∫—ñ–≤
- `src/app/ui_state.py`: ~200 —Ä—è–¥–∫—ñ–≤

### –î–∞–Ω—ñ
- –ü–µ—Ä—ñ–æ–¥: 2015-01-06 –¥–æ 2025-12-16
- –†–∏–Ω–∫–∏: EUR, JPY, GBP, GOLD (4 —Ä–∏–Ω–∫–∏)
- –†—è–¥–∫—ñ–≤ –≤ canonical: ~2,288 (4 —Ä–∏–Ω–∫–∏ √ó ~572 —Ç–∏–∂–Ω—ñ)
- –†—è–¥–∫—ñ–≤ –≤ metrics: ~9,027 (–≤—Å—ñ —Ä–∏–Ω–∫–∏, –≤—Å—ñ —Ç–∏–∂–Ω—ñ)
- –ö–æ–ª–æ–Ω–æ–∫ –≤ metrics: 144

### –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
- pandas>=2.2
- pyarrow>=16.0
- pyyaml>=6.0
- streamlit>=1.28.0
- requests>=2.31
- tenacity>=8.2

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è –Ω–æ–≤–æ–≥–æ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä–∞

### –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–Ω—ñ)
1. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –≤–µ–ª–∏–∫–∏—Ö —Ñ–∞–π–ª—ñ–≤:**
   - –†–æ–∑–±–∏—Ç–∏ `build_metrics.py` –Ω–∞ –º–æ–¥—É–ª—ñ
   - –†–æ–∑–±–∏—Ç–∏ `overview.py` –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏

2. **–î–æ–¥–∞—Ç–∏ —Ç–µ—Å—Ç–∏:**
   - Unit tests –¥–ª—è –º–µ—Ç—Ä–∏–∫
   - Integration tests –¥–ª—è pipeline
   - Snapshot tests –¥–ª—è UI

3. **–î–æ–∫—É–º–µ–Ω—Ç—É–≤–∞—Ç–∏ –º–µ—Ç—Ä–∏–∫–∏:**
   - –ê—É–¥–∏—Ç –º–µ—Ç—Ä–∏–∫ (—è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è, —è–∫—ñ –∑–∞—Å—Ç–∞—Ä—ñ–ª—ñ)
   - –î–æ–∫—É–º–µ–Ω—Ç—É–≤–∞—Ç–∏ —Ñ–æ—Ä–º—É–ª–∏

### –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç 2 (–í–∞–∂–ª–∏–≤—ñ)
1. **–£—Å—É–Ω—É—Ç–∏ –¥—É–±–ª—é–≤–∞–Ω–Ω—è:**
   - –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `src/common/paths.py` –¥–ª—è –≤—Å—ñ—Ö —à–ª—è—Ö—ñ–≤
   - –°—Ç–≤–æ—Ä–∏—Ç–∏ —Å–ø—ñ–ª—å–Ω—ñ —É—Ç–∏–ª—ñ—Ç–∏ –¥–ª—è UI

2. **–ü–æ–∫—Ä–∞—â–∏—Ç–∏ error handling:**
   - –î–æ–¥–∞—Ç–∏ –æ–±—Ä–æ–±–∫—É –ø–æ–º–∏–ª–æ–∫ —É –≤—Å—ñ—Ö –º–æ–¥—É–ª—è—Ö
   - –î–æ–¥–∞—Ç–∏ logging –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

3. **–û—á–∏—Å—Ç–∏—Ç–∏ –∑–∞—Å—Ç–∞—Ä—ñ–ª—ñ —Ñ–∞–π–ª–∏:**
   - –í–∏–¥–∞–ª–∏—Ç–∏ `canonical_schema.py` (legacy)
   - –û—á–∏—Å—Ç–∏—Ç–∏ —Å—Ç–∞—Ä—ñ backups

### –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç 3 (–ë–∞–∂–∞–Ω—ñ)
1. **–ü–æ–∫—Ä–∞—â–∏—Ç–∏ deployment:**
   - –†–æ–∑–≥–ª—è–Ω—É—Ç–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏ Streamlit Cloud
   - –ê–±—Å—Ç—Ä–∞–≥—É–≤–∞—Ç–∏ deployment logic

2. **–ü–æ–∫—Ä–∞—â–∏—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é:**
   - –î–æ–¥–∞—Ç–∏ API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é
   - –î–æ–¥–∞—Ç–∏ –¥—ñ–∞–≥—Ä–∞–º–∏ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏

3. **–ü–æ–∫—Ä–∞—â–∏—Ç–∏ type hints:**
   - –î–æ–¥–∞—Ç–∏ type hints –¥–ª—è –≤—Å—ñ—Ö –ø—É–±–ª—ñ—á–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π
   - –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ mypy –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏

---

## üìö –ö–æ—Ä–∏—Å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è

- **GitHub repo (dev):** `cot-mvp` (–æ—Å–Ω–æ–≤–Ω–∏–π —Ä–µ–ø–æ)
- **GitHub repo (deploy):** `YutikSt88/cot-mvp-app` (Streamlit Cloud)
- **Streamlit Cloud:** `cot-app.streamlit.app`
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è:** `docs/` –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è
- **README:** `README.md` (–¥–µ—Ç–∞–ª—å–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è)

---

## üîí MVP Business Rules (Frozen)

–¶—ñ –ø—Ä–∞–≤–∏–ª–∞ **–ù–ï –ú–û–ñ–ù–ê** –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –±–µ–∑ —É–∑–≥–æ–¥–∂–µ–Ω–Ω—è:

- **Data source:** Legacy COT only
- **Trader groups:**
  - Non-Commercial = Funds / Large Specs
  - No Asset Manager / Leveraged Funds split
- **Net positioning metrics:** ENABLED
- **Compute is source of truth;** UI is render-only
- **Flow Quality / Rebalance metrics:** experimental (UX may change)

---

**–û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:** 2026-01-08  
**–í–µ—Ä—Å—ñ—è:** v1.1.6
